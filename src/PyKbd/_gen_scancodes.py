from typing import NamedTuple

from PyKbd.layout import ScanCode


class Entry(NamedTuple):
    label: str | None  # label on US English or other hint
    set1: ScanCode
    set2: ScanCode | None
    set3: ScanCode | None


def _generate(f):
    data = r"""
01|??|??|ESCAPE
02|??|??|1
03|??|??|2
04|??|??|3
05|??|??|4
06|??|??|5
07|??|??|6
08|??|??|7
09|??|??|8
0A|??|??|9
0B|??|??|0
0C|??|??|- _
0D|??|??|= +
0E|??|??|BACKSPACE
0F|??|??|TAB
10|??|??|Q
11|??|??|W
12|??|??|E
13|??|??|R
14|??|??|T
15|??|??|Y
16|??|??|U
17|??|??|I
18|??|??|O
19|??|??|P
1A|??|??|[ {
1B|??|??|] }
1C|??|??|ENTER
1D|??|??|LEFT CTRL
1E|??|??|A
1F|??|??|S
20|??|??|D
21|??|??|F
22|??|??|G
23|??|??|H
24|??|??|J
25|??|??|K
26|??|??|L
27|??|??|; :
28|??|??|' "
29|??|??|` ~
2A|??|??|LEFT SHIFT
2B|??|??|\ |
2C|??|??|Z
2D|??|??|X
2E|??|??|C
2F|??|??|V
30|??|??|B
31|??|??|N
32|??|??|M
33|??|??|, <
34|??|??|. >
35|??|??|/ ?
36|??|??|RIGHT SHIFT
37|??|??|NUMPAD *
38|??|??|LEFT ALT
39|??|??|SPACE
3A|??|??|CAPSLOCK
3B|??|??|F1
3C|??|??|F2
3D|??|??|F3
3E|??|??|F4
3F|??|??|F5
40|??|??|F6
41|??|??|F7
42|??|??|F8
43|??|??|F9
44|??|??|F10
45|??|??|NUMLOCK (TODO weirdness with pause key)
46|??|??|SCROLL LOCK
47|??|??|NUMPAD 7 HOME
48|??|??|NUMPAD 8 UP
49|??|??|NUMPAD 9 PAGE UP
4A|??|??|NUMPAD -
4B|??|??|NUMPAD 4 LEFT
4C|??|??|NUMPAD 5 CLEAR
4D|??|??|NUMPAD 6 RIGHT
4E|??|??|NUMPAD +
4F|??|??|NUMPAD 1 END
50|??|??|NUMPAD 2 DOWN
51|??|??|NUMPAD 3 PAGE DOWN
52|??|??|NUMPAD 0 INSERT
53|??|??|NUMPAD . DELETE
54|??|??|SNAPSHOT (TODO ?)
56|??|??|ISO key (next to LEFT SHIFT)
57|??|??|F11
58|??|??|F12
59|??|??|CLEAR (TODO ?)
5A|??|??|WINVK_OEM_WSCTRL
5B|??|??|WINVK_OEM_FINISH
5C|??|??|WINVK_OEM_JUMP
5D|??|??|WINVK_EREOF
5E|??|??|WINVK_BACKTAB
5F|??|??|WINVK_AUTO
62|??|??|WINVK_ZOOM
63|??|??|WINVK_HELP
64|??|??|F13
65|??|??|F14
66|??|??|F15
67|??|??|F16
68|??|??|F17
69|??|??|F18
6A|??|??|F19
6B|??|??|F20
6C|??|??|F21
6D|??|??|F22
6E|??|??|F23
6F|??|??|WINVK_OEMPA3
71|??|??|WINVK_OEMRESET
73|??|??|ABNT_C1 (Brazil, next to RIGHT SHIFT)
76|??|??|F24
7B|??|??|WINVK_OEM_PA1 (Japan?)
7C|??|??|WINVK_TAB (?)
7E|??|??|ABNT_C2 (Brazil)
7F|??|??|WINVK_OEM_PA2 (Japan?)

E0,10|??|??|WINVK_MEDIA_PREV_TRACK
E0,19|??|??|WINVK_MEDIA_NEXT_TRACK
E0,1C|??|??|NUMPAD ENTER
E0,1D|??|??|RIGHT CTRL
E0,20|??|??|WINVK_VOLUME_MUTE
E0,21|??|??|WINVK_LAUNCH_APP2 (TODO calculator?)
E0,22|??|??|WINVK_MEDIA_PLAY_PAUSE
E0,24|??|??|WINVK_MEDIA_STOP
E0,2E|??|??|WINVK_VOLUME_DOWN
E0,30|??|??|WINVK_VOLUME_UP
E0,32|??|??|WINVK_BROWSER_HOME
E0,35|??|??|NUMPAD /
E0,37|??|??|SNAPSHOT (TODO ?)
E0,38|??|??|RIGHT ALT (GR)
E0,46|??|??|CANCEL (TODO ?)
E0,47|??|??|HOME
E0,48|??|??|UP
E0,49|??|??|PAGE UP
E0,4B|??|??|LEFT
E0,4D|??|??|RIGHT
E0,4F|??|??|END
E0,50|??|??|DOWN
E0,51|??|??|PAGE DOWN
E0,52|??|??|INSERT
E0,53|??|??|DELETE
E0,5B|??|??|LEFT WIN
E0,5C|??|??|RIGHT WIN
E0,5D|??|??|APPS (MENU)
E0,5E|??|??|POWER
E0,5F|??|??|SLEEP
TODO E0,63 wake?
E0,65|??|??|WINVK_BROWSER_SEARCH
E0,66|??|??|WINVK_BROWSER_FAVORITES
E0,67|??|??|WINVK_BROWSER_REFRESH
E0,68|??|??|WINVK_BROWSER_STOP
E0,69|??|??|WINVK_BROWSER_FORWARD
E0,6A|??|??|WINVK_BROWSER_BACK
E0,6B|??|??|WINVK_LAUNCH_APP1 (TODO my computer?)
E0,6C|??|??|WINVK_LAUNCH_MAIL
E0,6D|??|??|WINVK_LAUNCH_MEDIA_SELECT

E1,1D|??|??|PAUSE (E1,LCtrl,NumLock)
    """

    lines = data.splitlines()
    table = []
    for line in lines:
        cols = list(map(lambda s: s.strip(), line.strip().split("|", maxsplit=3)))
        if len(cols) == 1:
            continue  # skip empty/comment lines
        name = cols[3] if len(cols) > 3 else None
        set1 = ScanCode.from_string(cols[0])
        set2 = ScanCode.from_string(cols[1]) if cols[1] != "??" else None
        set3 = ScanCode.from_string(cols[2]) if cols[2] != "??" else None
        table.append(Entry(name, set1, set2, set3))
    table.sort(key=lambda entry: entry.set1.to_string())

    print("table = [", file=f)
    for entry in table:
        print(f"    {entry!r},", file=f)
    print("]", file=f)
    print(file=f)






if __name__ == '__main__':
    def _main():
        import sys
        dir, sep, file = __file__.rpartition("_gen_")
        if sep != "_gen_":
            raise RuntimeError("This is the generated file. "
                               "Please run the _gen_ version to regenerate it.")

        if len(sys.argv) != 1:
            # TODO is there any authoritative document listing all scan codes?
            raise RuntimeError("Please provide no arguments.")

        # with open(sys.argv[1], "r", encoding="ascii", errors="strict") as f:
        #     winuser = f.readlines()

        with open(dir + file, "w", encoding="ascii", errors="strict") as f:
            print("# ----- DO NOT EDIT THIS GENERATED FILE -----", file=f)
            print(file=f)
            with open(__file__, "r", encoding="ascii", errors="strict") as s:
                f.write(s.read())
            print(file=f)
            _generate(f)

    _main()

# ----- start generated content -----
